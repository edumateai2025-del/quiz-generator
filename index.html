<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EduMate ‚Äî Full App</title>
<style>
body { margin:0; font-family:'Inter',Arial,sans-serif; background:#0f0f0f; color:#fff; overflow:hidden; }
canvas#bg { position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; }
.container { flex:1; display:flex; justify-content:center; align-items:center; text-align:center; flex-direction:column; height:100vh; }
h1 { font-size:32px; margin-bottom:0; min-height:48px; white-space:pre; }
.buttons { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); width:300px; text-align:center; }
button { display:block; margin:12px auto; padding:16px 32px; font-size:18px; border:none; border-radius:12px; cursor:pointer; font-weight:700; box-shadow:0 4px 15px rgba(0,0,0,0.4); }
#startBtn { background:#10b981; color:#fff; }
#adminBtn { background:#ef4444; color:#fff; }
.curve { width:100%; height:60px; background:rgba(255,255,255,0.05); border-top-left-radius:50% 40px; border-top-right-radius:50% 40px; margin-bottom:12px; }

/* Admin & Quiz styles */
#adminArea, #quizAreaContainer { display:none; padding:20px; max-width:800px; margin:0 auto; }
input, textarea, select { width:100%; padding:8px; border-radius:8px; border:1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color:#fff; margin-bottom:8px; }
textarea{resize:none;}
.card{background:rgba(255,255,255,0.05); padding:12px; border-radius:10px; margin-bottom:10px; box-shadow:0 6px 18px rgba(0,0,0,0.4);}
.actions{display:flex; gap:8px; margin-top:8px;}
button.ghost{background:transparent;color:#9fb4d8;border:1px solid rgba(255,255,255,0.2);}
#timer{ text-align:center; font-size:18px; margin:10px; color:#ffeb3b; }
.results { background: rgba(255,255,255,0.06); padding: 14px; border-radius: 10px; margin-top: 12px; }
.options button { display:block; width:100%; text-align:left; margin:8px 0; padding:10px; border-radius:8px; background: rgba(255,255,255,0.06); color:#fff; }
.options button.selected { outline:3px solid rgba(16,185,129,0.6); }
</style>
</head>
<body>
<canvas id="bg"></canvas>

<div class="container" id="landing">
  <h1 id="liveText"></h1>
  <div class="buttons">
    <div class="curve"></div>
    <button id="startBtn">Start Quiz</button>
    <button id="adminBtn">Admin Dashboard</button>
  </div>
</div>

<!-- Admin Dashboard -->
<div id="adminArea">
  <h2>Admin ‚Äî Question Bank</h2>
  <label>Question</label>
  <textarea id="q_text" rows="3" placeholder="Type question here"></textarea>
  <input id="opt_a" placeholder="Option A">
  <input id="opt_b" placeholder="Option B">
  <input id="opt_c" placeholder="Option C">
  <input id="opt_d" placeholder="Option D">
  <select id="correct">
    <option value="">Select correct option</option>
    <option value="A">A</option>
    <option value="B">B</option>
    <option value="C">C</option>
    <option value="D">D</option>
  </select>
  <button id="saveBtn">Save Question</button>
  <button id="backFromAdmin" class="ghost">Back</button>
  <h3>Total Questions</h3>
  <div id="list"></div>
</div>

<!-- Quiz Area -->
<div id="quizAreaContainer">
  <div id="timer"></div>
  <div id="quizArea"></div>
  <button id="nextBtn">Next Question</button>
  <div id="resultArea"></div>
  <button id="backFromQuiz" class="ghost">Back</button>
</div>

<script>
// ==== Particle Background ====
const canvas=document.getElementById('bg'), ctx=canvas.getContext('2d');
let W=canvas.width=window.innerWidth,H=canvas.height=window.innerHeight;
window.addEventListener('resize',()=>{ W=canvas.width=window.innerWidth; H=canvas.height=window.innerHeight; });
const particles=[];
for(let i=0;i<100;i++){particles.push({x:Math.random()*W,y:Math.random()*H,r:Math.random()*2+1,dx:(Math.random()-0.5)*0.7,dy:(Math.random()-0.5)*0.7});}
function draw(){ctx.clearRect(0,0,W,H); particles.forEach(p=>{ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fillStyle='rgba(255,255,255,0.2)'; ctx.fill(); p.x+=p.dx; p.y+=p.dy; if(p.x<0||p.x>W)p.dx*=-1;if(p.y<0||p.y>H)p.dy*=-1;}); requestAnimationFrame(draw);}
draw();

// ==== Live Typing ====
const messages = ["Test Your Knowledge!","Ready for the Challenge?","Learn, Practice, Excel!","20 Questions Await You!","Start Your Quiz Adventure!"];
let msgIndex=0,charIndex=0,deleting=false;
function typeEffect(){const el=document.getElementById('liveText');if(!deleting){el.textContent=messages[msgIndex].slice(0,charIndex++);if(charIndex>messages[msgIndex].length){deleting=true; setTimeout(typeEffect,1000); return;}}else{el.textContent=messages[msgIndex].slice(0,charIndex--);if(charIndex<0){deleting=false; msgIndex=(msgIndex+1)%messages.length;}} setTimeout(typeEffect,deleting?50:120);}
typeEffect();

// ==== IndexedDB ====
const DB_NAME='edumate_questions_db', STORE='questions'; let db; let editingId=null;
function openDB(){return new Promise((resolve,reject)=>{const req=indexedDB.open(DB_NAME,1);req.onupgradeneeded=e=>{db=e.target.result;if(!db.objectStoreNames.contains(STORE))db.createObjectStore(STORE,{keyPath:'id', autoIncrement:true});}; req.onsuccess=e=>{db=e.target.result; resolve(db);}; req.onerror=e=>reject(e);});}
function addQuestion(obj){return new Promise((res,rej)=>{const tx=db.transaction(STORE,'readwrite'); tx.objectStore(STORE).add(obj); tx.oncomplete=()=>res(); tx.onerror=e=>rej(e);});}
function putQuestion(obj){return new Promise((res,rej)=>{const tx=db.transaction(STORE,'readwrite'); tx.objectStore(STORE).put(obj); tx.oncomplete=()=>res(); tx.onerror=e=>rej(e);});}
function deleteQuestion(id){return new Promise((res,rej)=>{const tx=db.transaction(STORE,'readwrite'); tx.objectStore(STORE).delete(id); tx.oncomplete=()=>res(); tx.onerror=e=>rej(e);});}
function getAll(){return new Promise((res,rej)=>{const tx=db.transaction(STORE,'readonly'); const req=tx.objectStore(STORE).getAll(); req.onsuccess=()=>res(req.result); req.onerror=e=>rej(e);});}
function clearDB(){return new Promise((res,rej)=>{const tx=db.transaction(STORE,'readwrite'); tx.objectStore(STORE).clear(); tx.oncomplete=()=>res(); tx.onerror=e=>rej(e);});}

// ==== Admin ====
const qText=document.getElementById('q_text'),a=document.getElementById('opt_a'),b=document.getElementById('opt_b'),c=document.getElementById('opt_c'),d=document.getElementById('opt_d'),correct=document.getElementById('correct');
const saveBtn=document.getElementById('saveBtn'),listEl=document.getElementById('list'),backFromAdmin=document.getElementById('backFromAdmin');

async function refreshList(){listEl.innerHTML=''; const items=await getAll(); if(!items.length){listEl.innerHTML='<div class="card">No questions saved yet.</div>'; return;} items.forEach(it=>{ const card=document.createElement('div'); card.className='card'; const q=document.createElement('div'); q.innerHTML=`<strong>Q${it.id}:</strong> ${it.q}`; const ops=document.createElement('pre'); ops.innerHTML=`A:${it.options[0]} B:${it.options[1]} C:${it.options[2]} D:${it.options[3]} \nCorrect:${it.answer}`; const actions=document.createElement('div'); actions.className='actions'; const edit=document.createElement('button'); edit.textContent='Edit'; edit.className='ghost'; edit.onclick=()=>{editingId=it.id; qText.value=it.q;a.value=it.options[0];b.value=it.options[1];c.value=it.options[2];d.value=it.options[3]; const idx=['A','B','C','D'].indexOf(it.answer); correct.value=idx>=0?['A','B','C','D'][idx]:''; window.scrollTo({top:0,behavior:'smooth'});}; const del=document.createElement('button'); del.textContent='Delete'; del.onclick=async()=>{if(confirm('Delete this question?')){await deleteQuestion(it.id); refreshList();}}; actions.appendChild(edit); actions.appendChild(del); card.appendChild(q); card.appendChild(ops); card.appendChild(actions); listEl.appendChild(card);});}

function resetForm(){qText.value=''; a.value=''; b.value=''; c.value=''; d.value=''; correct.value=''; editingId=null;}

saveBtn.addEventListener('click',async()=>{const Q=qText.value.trim();const opts=[a.value.trim(),b.value.trim(),c.value.trim(),d.value.trim()];const corr=correct.value;if(!Q||opts.some(x=>!x)||!corr){alert('Fill question, all options & select correct.'); return;} const answerIndex={'A':0,'B':1,'C':2,'D':3}[corr]; const obj={q:Q,options:opts,answer:opts[answerIndex]}; if(editingId){obj.id=editingId; await putQuestion(obj);} else {await addQuestion(obj);} resetForm(); await refreshList();});

// ==== Quiz ====
let currentIndex=0, quizQuestions=[], answers=[], timerInterval; const timePerQuestion=25;
const startBtn=document.getElementById('startBtn'),nextBtn=document.getElementById('nextBtn'),quizArea=document.getElementById('quizArea'),timerEl=document.getElementById('timer'),resultArea=document.getElementById('resultArea');
function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr;}

function speakQuestion(text){if('speechSynthesis' in window){const utter=new SpeechSynthesisUtterance(text); window.speechSynthesis.speak(utter);}}

function startTimer(callback){let timeLeft=timePerQuestion; timerEl.textContent=`Time: ${timeLeft}s`; timerInterval=setInterval(()=>{timeLeft--; timerEl.textContent=`Time: ${timeLeft}s`; if(timeLeft<=5 && timeLeft>0){timerEl.style.color='#f87171'; const audio=new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg'); audio.play();} else timerEl.style.color='#ffeb3b'; if(timeLeft<=0){clearInterval(timerInterval); callback();}},1000);}

function showQuestion(idx){quizArea.innerHTML=''; if(idx>=quizQuestions.length){showResults(); return;} const q=quizQuestions[idx]; const card=document.createElement('div'); card.className='card'; const qEl=document.createElement('div'); qEl.className='question'; qEl.textContent=`${idx+1}. ${q.q}`; card.appendChild(qEl); const ops=document.createElement('div'); ops.className='options'; q.options.forEach(opt=>{ const btn=document.createElement('button'); btn.textContent=opt; btn.onclick=()=>{ answers[idx]=opt; Array.from(ops.children).forEach(ch=>ch.classList.remove('selected')); btn.classList.add('selected'); }; ops.appendChild(btn); }); card.appendChild(ops); quizArea.appendChild(card); speakQuestion(q.q); startTimer(()=>nextQuestion());}

function nextQuestion(){clearInterval(timerInterval); currentIndex++; if(currentIndex<quizQuestions.length){showQuestion(currentIndex);} else {showResults();}}

function showResults(){let score=0; const details=[]; quizQuestions.forEach((q,i)=>{ const user=answers[i]; const correct=q.answer; if(user===correct) score++; details.push({q:q.q,correct,user:user||'No answer',ok:user===correct}); }); const percent=Math.round((score/quizQuestions.length)*100); let feedback=''; if(percent>=70) feedback='Brilliant! üåü'; else if(percent>=45) feedback='Great job! üëç'; else feedback='Try harder ‚Äî never give up! üí™'; resultArea.innerHTML=''; const summary=document.createElement('div'); summary.className='results'; summary.innerHTML=`<strong>Score:</strong> ${score}/${quizQuestions.length} (${percent}%)<br><strong>${feedback}</strong>`; resultArea.appendChild(summary); const detailCard=document.createElement('div'); detailCard.style.marginTop='12px'; details.forEach(d=>{const line=document.createElement('div'); line.style.padding='8px'; line.style.borderBottom='1px solid rgba(255,255,255,0.04)'; line.innerHTML=`<strong>Q:</strong> ${d.q}<br>Your: <span style="color:${d.ok?'#6ee7b7':'#ff9b9b'}">${d.user}</span> ‚Äî Correct: <strong>${d.correct}</strong>`; detailCard.appendChild(line);}); resultArea.appendChild(detailCard); nextBtn.style.display='none';}

// ==== Button Actions ====
startBtn.onclick=async()=>{
  landing.style.display='none';
  quizAreaContainer.style.display='block';
  await openDB();
  const storedQuestions = await getAll();
  if(!storedQuestions.length){alert('No questions in DB!'); landing.style.display='flex'; quizAreaContainer.style.display='none'; return;}
  quizQuestions=shuffle(storedQuestions).slice(0,20); quizQuestions.forEach(q=>q.options=shuffle(q.options));
  answers=new Array(quizQuestions.length).fill(null); currentIndex=0;
  showQuestion(currentIndex);
  nextBtn.style.display='inline-block';
};

document.getElementById('nextBtn').onclick=nextQuestion;

// Admin button
const landing=document.getElementById('landing');
const adminBtn=document.getElementById('adminBtn');
const adminArea=document.getElementById('adminArea');
adminBtn.onclick=async()=>{
  const pwd=prompt("Enter Admin Password:");
  if(pwd==='201015'){landing.style.display='none'; adminArea.style.display='block'; await openDB(); refreshList();}
  else alert("Wrong password!");
};

// Back buttons
document.getElementById('backFromAdmin').onclick=()=>{adminArea.style.display='none'; landing.style.display='flex';};
document.getElementById('backFromQuiz').onclick=()=>{quizAreaContainer.style.display='none'; landing.style.display='flex';};

window.addEventListener('load', async()=>{await openDB();});

</script>
</body>
  </html>
